---
title: Shell-Part1-文件安全与权限
tags: Shell
date: 2018-02-01 09:57:43
---

为了防止未授权用户访问你的文件,可以在文件和目录上设置权限位。还可以设定文件在创建时所具有的缺省权限:这些只是整个系统安全问题中的一小部分。

创建文件的用户和他(她)所属于的组拥有该文件。文件的属主可以设定谁具有读、写、执行该文件的权限。当然,根用户或系统管理员可以改变任何普通用户的设置。一个文件一经创建,就具有三种访问方式: 

1) 读   ,可以显示该文件的内容。
2) 写   ,可以编辑或删除它。
3) 执行 ,如果该文件是一个shell脚本或程序。

按照所针对的用户,文件的权限可分为三类:

1) 文件属主,创建该文件的用户。
2) 同组用户,拥有该文件的用户组中的任何用户。
3) 其他用户,即不属于拥有该文件的用户组的某一用户。
- ### 文件

---
当你创建一个文件的时候,系统保存了有关该文件的全部信息,包括:

• 文件的位置。
• 文件类型。
• 文件长度。

• 哪位用户拥有该文件,哪些用户可以访问该文件。

• i节点。
• 文件的修改时间。
• 文件的权限位。

命令:
~~~
$ls -l
~~~
- ### 文件类型

---
文件类型有七种

d 目录。
l 符号链接(指向另一个文件 )。
s 套接字文件。
b 块设备文件。
c 字符设备文件。
p 命名管道文件。
- 普通文件
- ### 权限

---
权限中的三组字符(除了第一个字符)分别定义了:

1) 文件属主所拥有的权限。
2) 文件属主缺省组 (一个用户可以属于很多的组 )所拥有的权限。
3) 系统中其他用户的权限。

在每一组字符中含有三个权限位:

r 读权限
w 写/更改权限
x 执行该脚本或程序的权限

- ### 改变权限位

---
~~~
$ chmod [who] operator [permission] filename
~~~
[who]的含义：

u 文件属主权限。
g 同组用户权限。
o 其他用户权限。
a 所有用户(文件属主、同组用户及其他用户 )。

operator的含义：

+ 增加权限。
- 取消权限。
= 设定权限。

permission的含义:

r 读权限。
w 写权限。
x 执行权限。
s 文件属主和组set-ID。
t 粘性位*。
l 给文件加锁,使其他用户无法访问。
u,g,o 针对文件属主、同组用户及其他用户

- ### 目录

---
目录的权限位和文件有所不同。目录的读权限位意味着可以列出其中的内容。写权限位意味着可以在该目录中创建文件,如果不希望其他用户在你的目录中创建文件,可以取消相应的写权限位。执行权限位则意味着搜索和访问该目录。**目录的权限将会覆盖该目录中文件的权限**
- ### suid/guid

---
suid意味着如果某个用户对属于自己的shell脚本设置了这种权限,那么其他用户在执行这一脚本时也会具有其属主的相应权限。于是,如果根用户的某一个脚本设置了这样的权限,那么其他普通用户在执行它的期间也同样具有根用户的权限。同样的原则也适用于guid,执行相应脚本的用户将具有该文件所属用户组中用户的权限。
~~~
#可以通过下列程序查看是否设置了suid权限
$cd /bin/ && ls -l | grep '^...s'
#可以通过下面的例子来设置suid权限位
$chomod u+s <filename>
~~~
- ### chown和chgrp

---
chown命令的一般形式为:
~~~
$chmod -R -h owner file
~~~
- R选项意味着对所有子目录下的文件也都进行同样的操作。
-h选项意味着在改变符号链接文件的属主时不影响该链接所指向的目标文件。

chgrp命令和chown命令的格式差不多
- ### umask

---
当最初登录到系统中时,umask命令确定了你创建文件的缺省模式。这一命令实际上和chmod命令正好相反。你的系统管理员必须要为你设置一个合理的umask值,以确保你创建的文件具有所希望的缺省权限,防止其他非同组用户对你的文件具有写权限。在已经登录之后,可以按照个人的偏好使用umask命令来改变文件创建的缺省权限。相应的改变直到退出该shell或使用另外的umask命令之前一直有效。一般来说,umask命令是在/etc/profile文件中设置的,每个用户在登录时都会引用这个文件,所以如果希望改变所有用户的umask,可以在该文件中加入相应的条目。如果希望永久性地设置自己的umask值,那么就把它放在自己$HOME目录下的.profile或.bash_profile文件中。
~~~
#通过umask查看mask值
$umask 
~~~
- ### 符号链接

---
- #### 软链接
软链接实际上就是一个指向文件的指针。软链接的inode所指向的内容实际上是保存了一个绝对路径
~~~
$ln [-s] source_path target_path
~~~
- #### 硬链接
可以简单把它想成 C 语言中的指针。它指向了物理硬盘的一个区块，事实上文件系统会维护一个引用计数，只要有文件指向这个区块，它就不会从硬盘上消失。
~~~
$ln source_path target_path
~~~
