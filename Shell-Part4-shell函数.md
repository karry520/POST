---
title: Shell-Part4-shell函数
tags: Shell
date: 2018-02-01 10:01:16
---
shell允许将一组命令集或语句形成一个可用块，这些块称为shell函数。
- ### 在脚本中定义函数

---
标题是函数名。函数体是函数内的命令集合。标题名应该唯一；如果不是，将会混淆结果，因为脚本在查看调用脚本前将首先搜索函数调用相应的shell。
~~~
函数名（）
{ 
    命令1
    ...
}
或
function 函数名()
{
    ...
}
~~~
- ### 在脚本中使用函数

---
所有函数在使用前必须定义。这意味着必须将函数放在脚本开始部分，直至shell解释器首次发现它时，才可以使用。调用函数仅使用其函数名即可。
~~~
#!/bin/sh
function hello()
{
    echo "hello world!"
}

hello 
~~~
- ### 向函数传递参数

---
向函数传递参数就像在一般脚本中使用特殊变量$1,$2...$9一样，函数取得所传参数后，将原始参数传回shell脚本，因此最好先在函数内重新设置变量保存所传的参数。这样如果函数有一点错误，就可以通过已经本地化的变量名迅速加以跟踪。函数里调用参数（变量）的转换以下划线开始，后加变量名，如：_FILENAME或_filename。
~~~

~~~
- ### 从调用函数中返回

---
当函数完成处理或希望函数基于某一测试语句返回时，可做两种处理：
1) 让函数正常执行到函数末尾，然后返回脚本中调用函数的控制部分。
2) 使用return返回脚本中函数调用的下一条语句，可以带返回值。0为无错误，1为有错误。这是可选的，与最后状态命令报表例子极其类似。其格式为：
~~~
return从函数中返回，用最后状态命令决定返回值。
    Return 0无错误返回。
    Return 1有错误返回。
~~~
- ### 函数返回值测试

---
可以直接在脚本调用函数语句的后面使用最后状态命令来测试函数调用的返回值。例如：
~~~
if check_it_a_directory $FILENAME;#this is the function call and check
then
    echo "All is OK"
else 
    echo "Something went wrong!"
fi
~~~
- ### 在shell中使用函数

---
当你收集一些经常使用的函数时，可以将之放入函数文件中并将文件载入shell。
- ### 创建函数文件

---
例程：
~~~
#!/bin/sh
#function.main
function findit()
{
    if [ $# -lt 1 ]; then 
        echo "usage:find file"
        return 1
    fi
    find / -name $1 -print 
}
~~~

- ### 定位文件

---
定位文件格式为：
~~~
./pathname/filename
#载入function.main
. function.main
~~~
- ### 检查载入函数

---
使用set命令确保函数已载入。set命令将在shell中显示所有的载入函数。
~~~
$set 
~~~
- ### 执行shell函数

---
要执行函数，简单地键入函数名即可。这里是带有一个参数的findit函数，参数是某个系统文件。
~~~
$findit groups
~~~
- ### 函数调用　

---
使用函数的两种不同方法：从原文件中调用函数和使用脚本中的函数。｀
~~~
#从原文件中调用函数

#使用脚本中的函数
~~~
- ### 定位文件不只用于函数

---
定位文件不只针对于函数，也包含组成配置文件的全局变量。
~~~

~~~
